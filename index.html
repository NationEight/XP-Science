<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Timer Stylé</title>
<style>
:root {
  --primary: #02e8a1; /* couleur principale (barre et fond turquoise) */
  --primary-neon: 0 0 10px #02e8a1, 0 0 20px #02e8a1; /* effet néon turquoise */
  --flame-color: #ff7a00; /* couleur du logo flamme */
  --flame-neon: 0 0 8px #ff4500, 0 0 12px #ff6347; /* effet néon flamme plus rouge */
  --gain-color: #ff7a00; /* couleur du +1 */
  --background: #191919; /* fond global (Notion) */
  --progress-bg: #444; /* fond de la barre de progression */
  --progress-fill: #02e8a1; /* remplissage de la barre */
  --cagnotte-color: #ffffff; /* couleur du texte cagnotte */
}

body {
  background: var(--background);
  color: white;
  font-family: 'JetBrains Mono', monospace;
  padding: 20px;
}

/* Première ligne : barre + pourcentage */
.progress-container {
  display: flex;
  align-items: center;
  gap: 10px;
}
.progress-bar {
  flex: 1;
  height: 10px;
  background: var(--progress-bg);
  border-radius: 5px;
  overflow: hidden;
}
.progress-fill {
  height: 100%;
  background: var(--progress-fill);
  width: 0%;
  transition: width 0.1s linear; /* fluidité de la barre */
}
.progress-text {
  font-size: 18px; /* taille pourcentage */
  font-weight: 700; /* gras sur les chiffres */
}
.progress-text .num {
  font-weight: 700; /* chiffres gras */
}
.progress-text .unit {
  font-weight: 400; /* % non gras */
}

/* Bloc timer + flamme */
.timer-flame-container {
  margin-top: 10px;
  background: var(--primary);
  box-shadow: var(--primary-neon);
  padding: 10px;
  border-radius: 10px;
}

/* Timer */
.timer-row {
  display: flex;
  align-items: center;
  gap: 6px; /* espace entre boutons */
  margin-bottom: 8px;
}
.timer-display {
  font-size: 18px; /* taille timer */
  font-weight: 700;
}
.timer-display .num {
  font-weight: 700; /* chiffres gras */
}
.timer-display .unit {
  font-weight: 400;
}

/* Minutes box */
.minutes-input {
  width: 32px; /* largeur réduite pour 3 chiffres */
  font-size: 18px; /* Taille police box */
  font-family: 'JetBrains Mono', monospace;
  text-align: center;
  border: 1px solid var(--primary);
  outline: none;
  background: var(--background);
  color: var(--primary);
  font-weight: 700;
  border-radius: 4px;
}
.minutes-input::-webkit-outer-spin-button,
.minutes-input::-webkit-inner-spin-button {
  -webkit-appearance: none;
  margin: 0;
}
.minutes-input[type=number] {
  -moz-appearance: textfield; /* supprime flèches Firefox */
}

/* Boutons */
button {
  padding: 6px 10px;
  border: none;
  background: var(--primary);
  box-shadow: var(--primary-neon);
  color: black;
  font-weight: bold;
  border-radius: 6px;
  transition: transform 0.15s ease;
}
button:hover {
  transform: scale(1.08); /* effet grossissement */
}
button:active {
  transform: scale(0.95);
}

/* Ligne flamme + cagnotte */
.flame-row {
  display: flex;
  align-items: center;
  justify-content: space-between;
}
.flame-container {
  display: flex;
  align-items: center;
  font-family: 'Noto Sans JP', sans-serif; /* police logo */
  font-size: 20px; /* taille logo à l’arrêt */
  color: var(--flame-color);
  text-shadow: var(--flame-neon);
  transition: transform 0.3s ease;
}
.flame-container.pulsing {
  animation: pulseFlame 1.5s infinite ease-in-out;
}
@keyframes pulseFlame {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.06); }
}

/* +1 gain */
.gain-popup {
  position: absolute;
  font-size: 16px;
  color: var(--gain-color);
  font-weight: bold;
  opacity: 0;
  transform: scale(0.9) translateY(0px);
  animation: popFadeSmall 2.4s ease-out forwards; /* durée augmentée */
  margin-left: 2px;
  pointer-events: none;
}
@keyframes popFadeSmall {
  0%   { opacity: 0; transform: scale(0.9) translateY(0px); }
  10%  { opacity: 1; transform: scale(1) translateY(-2px); }
  80%  { opacity: 1; transform: scale(1.05) translateY(-6px); }
  100% { opacity: 0; transform: scale(1.05) translateY(-6px); }
}

/* Cagnotte */
.cagnotte {
  font-size: 18px;
  color: var(--cagnotte-color);
  font-weight: 700;
}
.cagnotte .zeros {
  opacity: 0.4; /* opacité des zéros */
}
</style>
</head>
<body>

<!-- Première ligne -->
<div class="progress-container">
  <div class="progress-bar">
    <div class="progress-fill" id="progressFill"></div>
  </div>
  <div class="progress-text">
    <span class="num" id="progressNum">0</span><span class="unit">%</span>
  </div>
</div>

<!-- Timer + flamme -->
<div class="timer-flame-container">
  <div class="timer-row">
    <input type="number" id="minutesInput" class="minutes-input" maxlength="3" min="0" max="999">
    <div class="timer-display" id="timerDisplay">
      <span class="num">00</span><span class="unit">h</span>
      <span class="num">00</span><span class="unit">m</span>
      <span class="num">00</span><span class="unit">s</span>
    </div>
    <button id="playBtn">PLAY</button>
    <button id="stopBtn">STOP</button>
  </div>
  <div class="flame-row">
    <div class="flame-container" id="flameLogo">火</div>
    <div style="position: relative;">
      <span class="cagnotte"><span class="zeros" id="zerosSpan">00000000000000</span><span id="cagnotteValue">0</span>F°</span>
    </div>
  </div>
</div>

<script>
/* ===== Variables principales ===== */
const minutesInput = document.getElementById("minutesInput");
const timerDisplay = document.getElementById("timerDisplay");
const playBtn = document.getElementById("playBtn");
const stopBtn = document.getElementById("stopBtn");
const progressFill = document.getElementById("progressFill");
const progressNum = document.getElementById("progressNum");
const flameLogo = document.getElementById("flameLogo");
const cagnotteValue = document.getElementById("cagnotteValue");
const zerosSpan = document.getElementById("zerosSpan");

let timerDuration = 0;
let timeLeft = 0;
let timerInterval;
let running = false;
let totalGain = 0;
let gainCounter = 0;
let lastGainTime = 0;

/* ===== Fonctions utilitaires ===== */
function updateTimerDisplay(sec) {
  let h = String(Math.floor(sec / 3600)).padStart(2, '0');
  let m = String(Math.floor((sec % 3600) / 60)).padStart(2, '0');
  let s = String(sec % 60).padStart(2, '0');
  timerDisplay.innerHTML =
    `<span class="num">${h}</span><span class="unit">h</span>` +
    `<span class="num">${m}</span><span class="unit">m</span>` +
    `<span class="num">${s}</span><span class="unit">s</span>`;
}

function updateProgress() {
  let percent = ((timerDuration - timeLeft) / timerDuration) * 100 || 0;
  progressFill.style.width = percent.toFixed(2) + "%";
  progressNum.textContent = Math.floor(percent);
}

function resetProgress() {
  progressFill.style.width = "0%";
  progressNum.textContent = "0";
}

/* Animation du +1 */
function showGainAnimation() {
  const popup = document.createElement("div");
  popup.className = "gain-popup";
  popup.textContent = "+1";
  flameLogo.appendChild(popup);
  setTimeout(() => popup.remove(), 2400);
}

/* ===== Contrôles ===== */
minutesInput.addEventListener('input', () => {
  if (minutesInput.value.length > 3) {
    minutesInput.value = minutesInput.value.slice(0, 3);
  }
  if (running) {
    clearInterval(timerInterval);
    running = false;
    playBtn.textContent = "PLAY";
    flameLogo.classList.remove("pulsing");
  }
  timerDuration = parseInt(minutesInput.value || 0) * 60;
  timeLeft = timerDuration;
  updateTimerDisplay(timeLeft);
  resetProgress();
});

playBtn.addEventListener('click', () => {
  if (!running) {
    if (timeLeft <= 0) {
      timerDuration = parseInt(minutesInput.value || 0) * 60;
      timeLeft = timerDuration;
      resetProgress();
    }
    lastGainTime = Date.now() - (gainCounter * 1000); // garde le décompte partiel
    running = true;
    playBtn.textContent = "PAUSE";
    flameLogo.classList.add("pulsing");
    timerInterval = setInterval(() => {
      timeLeft--;
      updateTimerDisplay(timeLeft);
      updateProgress();
      // Gestion du +1 toutes les 10s réelles
      if (Date.now() - lastGainTime >= 10000) {
        totalGain++;
        gainCounter = 0;
        lastGainTime = Date.now();
        cagnotteValue.textContent = totalGain;
        showGainAnimation();
      } else {
        gainCounter = Math.floor((Date.now() - lastGainTime) / 1000);
      }
      if (timeLeft <= 0) {
        clearInterval(timerInterval);
        running = false;
        playBtn.textContent = "PLAY";
        flameLogo.classList.remove("pulsing");
      }
    }, 1000);
  } else {
    running = false;
    clearInterval(timerInterval);
    playBtn.textContent = "PLAY";
    flameLogo.classList.remove("pulsing");
  }
});

stopBtn.addEventListener('click', () => {
  running = false;
  clearInterval(timerInterval);
  playBtn.textContent = "PLAY";
  flameLogo.classList.remove("pulsing");
  timeLeft = parseInt(minutesInput.value || 0) * 60;
  updateTimerDisplay(timeLeft);
  resetProgress();
  gainCounter = 0;
  lastGainTime = 0;
});

/* Valeurs initiales */
minutesInput.value = "";
updateTimerDisplay(0);
</script>
</body>
</html>
